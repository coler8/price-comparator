<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-title>
      <span class="gradient-text" style="font-size: 1.5rem">Coomparador</span>
    </ion-title>
    <ion-buttons slot="end">
      <ion-button color="dark">
        <ion-icon slot="icon-only" name="person-circle-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <div class="header-filters-wrapper">
    <ion-searchbar animated="true" placeholder="¿Qué buscas?" (ionInput)="onSearch($event)">
    </ion-searchbar>

    <div class="category-scroll">
      @for (cat of categories; track cat) {
      <div [class.active]="selectedCategory() === cat" class="category-chip" (click)="selectedCategory.set(cat)">
        {{cat}}
      </div>
      }
    </div>
  </div>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="main-content-wrapper ion-text-center">
    <h1 style="font-weight: 700; margin-bottom: 20px">
      Encuentra el mejor <span class="gradient-text">precio hoy</span>
    </h1>

    <ion-grid fixed>
      <ion-row>
        @defer (on viewport) { @for (product of filteredProducts(); track
        product.id) {
        <ion-col size="6" size-md="4" size-lg="3">
          <div class="glass-card product-card vertical" [routerLink]="['/product-detail', product.id]">
            <div class="product-image-container">
              <img [src]="product.image" [alt]="product.name" />
              <ion-button fill="clear" color="danger" class="delete-btn-overlay" (click)="deleteProduct(product.id, $event)">
                <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
              </ion-button>
            </div>
            
            <div class="product-info">
              <h3 class="product-name">
                {{product.name}}
              </h3>
              <p class="product-meta">
                {{product.unit}}
              </p>
              
              <div class="price-list mini">
                @for (p of product.prices; track p.supermarket) {
                <div class="price-item">
                  <img [src]="getSupermarketLogo(p.supermarket)" class="supermarket-logo" [alt]="p.supermarket" />
                  <span class="price-value" [class.cheapest]="getCheapest(product).supermarket === p.supermarket">
                    {{p.price | number:'1.2-2'}}€
                  </span>
                </div>
                }
              </div>
            </div>
          </div>
        </ion-col>
        } } @placeholder {
        <div class="ion-padding ion-text-center">
          <ion-spinner name="crescent"></ion-spinner>
          <p>Cargando productos...</p>
        </div>
        }
      </ion-row>
    </ion-grid>
    <div style="height: 100px;"></div>
  </div>
</ion-content>

<ion-footer class="ion-no-border">
  <div class="footer-scanner-container">
    <ion-button (click)="scanTicket()" class="premium-button scan-main-btn" fill="solid">
      <ion-icon slot="start" name="camera-outline"></ion-icon>
      Escanear Ticket
    </ion-button>
  </div>
</ion-footer>